@page
@model TrainingLibraryModel
@{
    ViewData["Title"] = "–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω—å";
}

<div class="container mt-4">
    <h2>üìö –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ —Ç—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º</h2>

    <div class="mb-3">
        @foreach (var pair in new[] {
                      new { Ua = "–ö–∞—Ä–¥—ñ–æ", En = "Cardio" },
                      new { Ua = "–°–∏–ª–æ–≤—ñ", En = "Strength" },
                      new { Ua = "–ì–Ω—É—á–∫—ñ—Å—Ç—å", En = "Flexibility" }
                  })
        {
            <a class="btn btn-outline-primary me-2"
               href="?category=@pair.En">@pair.Ua</a>
        }
        <a class="btn btn-outline-secondary" href="/TrainingLibrary">–£—Å—ñ</a>
    </div>
    
    @{
        var categoryMap = new Dictionary<string, string>
        {
            { "Cardio", "–ö–∞—Ä–¥—ñ–æ" },
            { "Strength", "–°–∏–ª–æ–≤—ñ" },
            { "Flexibility", "–ì–Ω—É—á–∫—ñ—Å—Ç—å" }
        };
        
        string GetYoutubeEmbedUrl(string originalUrl)
        {
            if (originalUrl.Contains("shorts/"))
            {
                var id = originalUrl.Split("shorts/")[1].Split('?')[0];
                return $"https://www.youtube.com/embed/{id}";
            }
            else if (originalUrl.Contains("watch?v="))
            {
                var id = originalUrl.Split("watch?v=")[1].Split('&')[0];
                return $"https://www.youtube.com/embed/{id}";
            }
            return originalUrl;
        }
    }

    <h4>üé¨ –í—ñ–¥–µ–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω—å</h4>
    <div class="row">
        @foreach (var video in Model.Videos)
        {
            var categoryUa = categoryMap.ContainsKey(video.Category ?? "") ? categoryMap[video.Category] : video.Category;

            <div class="col-md-4 mb-4">
                <div class="card">
                    <iframe class="card-img-top"
                            src="@GetYoutubeEmbedUrl(video.Url)"
                            allowfullscreen
                            style="aspect-ratio: 16/9; width: 100%; border: none;">
                    </iframe>
                    <div class="card-body">
                        <h5 class="card-title">@video.Title</h5>
                        <p class="card-text"><small>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: @categoryUa</small></p>
                        <p class="card-text"><small>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å: @video.Duration —Ö–≤</small></p>
                    </div>
                </div>
            </div>
        }
    </div>


    <h4 class="mt-5">üìã –¢—Ä–µ–Ω—É–≤–∞–ª—å–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏</h4>
    <ul class="list-group">
        @foreach (var p in Model.Programs)
        {
            <li class="list-group-item">
                <strong>@p.Name</strong> ‚Äî @p.Description
            </li>
        }
    </ul>
</div>